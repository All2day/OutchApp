<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' https://openlayers.org 'unsafe-inline'; script-src 'self' https://cdn.polyfill.io https://openlayers.org 'unsafe-inline' 'unsafe-eval'; worker-src * blob:;">

        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <link rel="stylesheet" type="text/css" href="css/index.css">
        <link rel="stylesheet" href="https://openlayers.org/en/v4.3.2/css/ol.css" type="text/css">
        <title>Hello World</title>
        <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
        <script src="https://openlayers.org/en/v4.3.2/build/ol.js"></script>
    </head>
    <body>
        <div id="map" class="map" style="width:100%;height:100%"></div>

        <!-- 3rd party libraries -->
        <script type="text/javascript" src="js/require.min.js"></script>
        <!--<script type="text/javascript" src="js/uno.js"></script>-->
        <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
        <!--<script type="text/javascript" src="js/basic.js"></script>
        <script type="text/javascript" src="js/scoperef.js"></script>
        <script type="text/javascript" src="js/actions.js"></script>
        <script type="text/javascript" src="js/gamestate.js"></script>
        <script type="text/javascript" src="js/view.js"></script>
        <script type="text/javascript" src="js/gameengine.js"></script>
        <script type="text/javascript" src="js/client.js"></script>-->

        <!--<script type="text/javascript" src="js/risk.js"></script>-->
        <!--<script type="text/javascript" src="js/test_game.js"></script>-->
        <script type="text/javascript">

require('js/client');

var qs = (function(a) {
    if (a == "") return {};
    var b = {};
    for (var i = 0; i < a.length; ++i)
    {
        var p=a[i].split('=', 2);
        if (p.length == 1)
            b[p[0]] = "";
        else
            b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
    }
    return b;
})(window.location.search.substr(1).split('&'));

var uno = require('js/uno');


window._client = new GameClient(uno.game,qs['UUID']||'mads');

_client.server = 'http://localhost:9615';
_client.startPinging();



/*
mads_vars = Variable._vars;
mads_nextId = Variable._nextId;

//reset the variable for mads
Variable._nextId = 1;
Variable._vars = {};

var gameServer = new GameServer(game);



var s = gameServer.gs.getFullState();

server_vars = Variable._vars;
server_nextId = Variable._nextId;

Variable._nextId = mads_nextId;
Variable._vars = mads_vars;

debugger;

mads.fullUpdate(s);

//check game state update
$.each(server_vars,function(i,o){
  //check existance
  if(Variable._vars[i] === undefined){
    console.log(i,'does not exits');
    return;
  }
  //check type
  if(!(Variable._vars[i] instanceof o.constructor)){
    console.log(i,'not same type');
    return;
  }

  //dont check contents if not mutatable
  if(o instanceof GameStateList || o instanceof ProtoType || o instanceof Phase || o instanceof ClientElement || o instanceof GameStateObject){
    return;
  }

  //check value
  if($.type(o._value) == 'object'){
    var c_value = jQuery.extend({},Variable._vars[i]._value);
    $.each(o._value,function(n,v){
      if(v._id != c_value[n]._id){
        console.log(i,'not pointing to the same');
      }
      delete c_value[n];
    });
    $.each(c_value,function(n,v){
      console.log(i,' not updated from server '+n);
    });
  }
  if($.type(o._value) == 'array'){
    var c_value = Variable._vars[i]._value.slice();

    $.each(o._value,function(n,v){
      if(v._id != c_value[n]._id){
        console.log(i,'not pointing to the same');
      }
      delete(c_value[n]);
    });
    $.each(c_value,function(n,v){
      if(v !== undefined)
        console.log(i,' not updated from server '+n);
    });
  }
});

console.log(s);

debugger;

//serverVars = Variable._vars;


/*
var gs1 = new GameState(game);
gs1_vars = Variable._vars;
Variable._nextId = 1;
Variable._vars = {};
ProtoType.prototypes = {};
console.log('gs2');
var gs2 = new GameState(game);
debugger;
*/



//mads.gsUpdate(gameServer.gs.players.mads.gsUpdates[0].changes);

/*gameServer.gs.triggerClientHook('mads','pickup',{list_el:'player.hand.pop'});
console.log('stack',gameServer.gs.currentPhase.vars.stack.get('last').getObject());
gameServer.gs.players.mads._value.currentCard._value.color._value = gameServer.gs.currentPhase.vars.stack.get('last').getObject().color;
console.log('current',gameServer.gs.players.mads._value.currentCard.getObject());


debugger;
gameServer.gs.triggerClientHook('mads','putdown',{});
*/
//gameServer.gs.loadPhase('play');
//debugger;
//var gs = new GameState(game);


//var gs = new GameStateObject();

/*var currentphase = new GameStateObject({
  fisk:{
    type:'string',
    value:'22 fisk'
  },
  fisk2:{
    fisk3:{
      type:'string',
      value:'32 fisk'
    },
    fisk4:{
      type:'number',
      value:5
    }
  },
  fisk8:{
    type:'number',
    value:3
  }
});

gs.add('currentphase',currentphase);

var fiskVar = new Variable('22 fisk');
currentphase.add('fisk',fiskVar);

var change_hook = new Hook();
var set_action = new SetAction('currentphase.fisk8','10');

//var alert_action = new AlertAction('fisk');


//change_hook.addAction(alert_action);
change_hook.addAction(set_action);

fiskVar.addHook('change',change_hook);


var change_hook2 = new Hook();
var alert_action2 = new AlertAction('currentphase.fisk2.fisk4+currentphase.fisk8');

change_hook2.addAction(alert_action2);

gs.get('currentphase').get('fisk8').addHook('change',change_hook2);

fiskVar.set('2fdt');
*/

//hook handler
//Hookable._handleTriggerQueue();

</script>


    </body>
</html>
